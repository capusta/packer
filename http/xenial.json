{
  "builders": [
  {
    "type": "virtualbox-iso",
    "guest_additions_mode":"upload",
    "guest_os_type": "Ubuntu_64",
    "iso_url": "iso/{{user `iso_name`}}",
    "iso_checksum": "{{user `iso_checksum`}}",
    "iso_checksum_type": "{{user `iso_checksum_type`}}",
    "vm_name": "{{user `vm_name`}}",
    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "ssh_wait_timeout": "15m",
    "boot_wait": "8s",
    "disk_size": "40000",
    "format": "ova",
    "output_directory": "{{user `output_directory` }}",
    "headless": false,
    "vboxmanage": [
      ["modifyvm", "{{.Name}}", "--memory", "2048"],
      ["modifyvm", "{{.Name}}", "--cpus", "2"],
      ["modifyvm", "{{.Name}}", "--natpf1", "devboxssh,tcp,,2223,,22"]
    ],
    "http_directory": ".",
    "boot_command": [
      "<enter><wait><f6><esc><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs>",
      "/install/vmlinuz noapic ",
      "vga=788 ",
      "debian-installer=en_US auto locale=en_US kbd-chooser/method=us ",
      "hostname={{user `vm_name`}} ",
      "grub-installer/bootdev=/dev/sda<wait> ",
      "fb=false debconf/frontend=noninteractive ",
      "keyboard-configuration/modelcode=SKIP keyboard-configuration/layout=USA ",
      "keyboard-configuration/variant=USA console-setup/ask_detect=false ",
      "passwd/user-fullname=vagrant ",
      "passwd/user-password=vagrant ",
      "passwd/user-password-again=vagrant ",
      "passwd/username=vagrant ",
      " initrd=/install/initrd.gz quiet",
      " preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/http/xenial.ks",
      " -- <wait>",
      "<enter><wait>"
    ],
    "shutdown_command": "shutdown -P now"
}
  ],
  "provisioners": [
   {
     "type": "ansible",
     "playbook_file": "./ansible/kickstart.yml",
     "user": "vagrant",
     "extra_arguments": ["--diff"]
    },
    {
     "type": "shell",
     "scripts": [
         "scripts/setup.sh",
         "scripts/cleanup.sh"
    ],
      "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'"
    }
 ]
}
