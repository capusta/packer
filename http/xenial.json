{
  "builders": [
  {
  "type": "virtualbox-iso",
  "guest_os_type": "Ubuntu_64",
  "guest_additions_mode":"disable",
  "iso_url": "iso/ubuntu-16.04.2-server-amd64.iso",
  "iso_checksum": "2bce60d18248df9980612619ff0b34e6",
  "iso_checksum_type": "md5",
  "ssh_username": "root",
  "ssh_password": "ansible",
  "ssh_wait_timeout": "1000s",
  "boot_wait": "5s",
  "disk_size": "60000",
  "format": "ova",
  "vm_name": "{{user `hostname`}}",
  "output_directory": "{{user `output_directory` }}",
  "headless": true,
  "vboxmanage": [
    ["modifyvm", "{{.Name}}", "--memory", "1024"],
    ["modifyvm", "{{.Name}}", "--cpus", "1"],
    ["modifyvm", "{{.Name}}", "--rtcuseutc", "on"],
    ["modifyvm","{{.Name}}", "--hwvirtex","on"],
    ["modifyvm","{{.Name}}", "--nestedpaging","on"],
    ["modifyvm","{{.Name}}", "--largepages","on"]
  ],
  "http_directory": ".",
  "boot_command": [
    "<enter><wait><f6><esc><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
          "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
          "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
          "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
          "/install/vmlinuz<wait>",
       " auto<wait>",
       " console-setup/ask_detect=false<wait>",
       " console-setup/layoutcode=us<wait>",
       " console-setup/modelcode=pc105<wait>",
       " debconf/frontend=noninteractive<wait>",
       " debian-installer=en_US.UTF-8<wait>",
       " fb=false<wait>",
       " initrd=/install/initrd.gz<wait>",
       " kbd-chooser/method=us<wait>",
       " keyboard-configuration/layout=USA<wait>",
       " keyboard-configuration/variant=USA<wait>",
       " locale=en_US.UTF-8<wait>",
       " netcfg/get_domain=vm<wait>",
       " netcfg/get_hostname=vagrant<wait>",
       " grub-installer/bootdev=/dev/vda<wait>",
       " noapic<wait>",
       " preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/http/xenial.ks<wait>",
       " -- <wait>",
       "<enter><wait>"
  ],
  "shutdown_command": "shutdown -P now"
}
  ],
  "provisioners": [
    {
    "type": "shell",
    "inline": [
      "mkdir /root/.ssh"
    ]
   },
   {
     "type": "file",
     "source": "./http/id_rsa_ansible.pub",
     "destination": "/root/.ssh/authorized_keys"
   },
   {
     "type": "ansible",
     "playbook_file": "./ansible/kickstart.yml",
     "user": "root",
     "extra_arguments": ["--diff"]
    },
    {
     "type": "shell",
     "scripts": [
         "scripts/setup.sh",
         "scripts/cleanup.sh"
    ]
    }
 ]
}
