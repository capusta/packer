{
  "builders": [
  {
    "type": "virtualbox-iso",
    "guest_additions_mode":"upload",
    "guest_os_type": "Ubuntu_64",
    "iso_url": "iso/{{user `iso_file`}}",
    "iso_checksum": "{{user `iso_checksum`}}",
    "iso_checksum_type": "md5",
    "vm_name": "{{user `hostname`}}",
    "ssh_username": "root",
    "ssh_password": "ansible",
    "ssh_wait_timeout": "1000s",
    "boot_wait": "5s",
    "disk_size": "60000",
    "format": "ova",
    "output_directory": "{{user `output_directory` }}",
    "headless": false,
    "vboxmanage": [
      ["modifyvm", "{{.Name}}", "--memory", "1024"],
      ["modifyvm", "{{.Name}}", "--cpus", "2"]
    ],
    "floppy_files": [
      "http/xenial.ks"
    ],
    "http_directory": ".",
    "boot_command": [
      "<enter><wait><f6><esc><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
      "<bs><bs><bs><bs>",
      "/install/vmlinuz noapic ",
      "file=/floppy/xenial.ks ",
      "vga=788 ",
      "debian-installer=en_US auto locale=en_US kbd-chooser/method=us ",
      "hostname={{user `hostname`}} ",
      "grub-installer/bootdev=/dev/sda<wait> ",
      "fb=false debconf/frontend=noninteractive ",
      "keyboard-configuration/modelcode=SKIP keyboard-configuration/layout=USA ",
      "keyboard-configuration/variant=USA console-setup/ask_detect=false ",
      "passwd/user-fullname=vagrant ",
      "passwd/user-password=vagrant ",
      "passwd/user-password-again=vagrant ",
      "passwd/username=vagrant ",
      "initrd=/install/initrd.gz quiet --- <enter>"
    ],
    "shutdown_command": "shutdown -P now"
}
  ],
  "provisioners": [
    {
    "type": "shell",
    "inline": [
      "mkdir /root/.ssh"
    ]
   },
   {
     "type": "file",
     "source": "./http/id_rsa_ansible.pub",
     "destination": "/root/.ssh/authorized_keys"
   },
   {
     "type": "ansible",
     "playbook_file": "./ansible/kickstart.yml",
     "user": "root",
     "extra_arguments": ["--diff"]
    },
    {
     "type": "shell",
     "scripts": [
         "scripts/setup.sh",
         "scripts/cleanup.sh"
    ]
    }
 ]
}
