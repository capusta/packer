{
  "builders": [
  {
  "type": "virtualbox-iso",
  "guest_os_type": "Ubuntu_64",
  "guest_additions_mode":"disable",
  "iso_url": "iso/{{user `iso_file`}}",
  "iso_checksum": "{{user `iso_checksum`}}",
  "iso_checksum_type": "md5",
  "ssh_username": "root",
  "ssh_password": "ansible",
  "ssh_wait_timeout": "1000s",
  "boot_wait": "5s",
  "disk_size": "60000",
  "format": "ova",
  "vm_name": "{{user `hostname`}}",
  "output_directory": "{{user `output_directory` }}",
  "headless": true,
  "vboxmanage": [
    ["modifyvm", "{{.Name}}", "--memory", "1024"],
    ["modifyvm", "{{.Name}}", "--cpus", "1"],
    ["modifyvm", "{{.Name}}", "--rtcuseutc", "on"],
    ["modifyvm","{{.Name}}", "--hwvirtex","on"],
    ["modifyvm","{{.Name}}", "--nestedpaging","on"],
    ["modifyvm","{{.Name}}", "--largepages","on"],
    ["modifyvm","{{.Name}}", "--natpf1", "guestssh,tcp,,2222,,22"]
  ],
  "http_directory": ".",
  "boot_command": [
    "<esc><esc><enter><wait>",
         "/install/vmlinuz<wait>",
         " initrd=/install/initrd.gz <wait>",
         " preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/http/trusty.ks<wait>",
         " console-setup/layoutcode=us",
         " debian-installer=en_US",
         " kbd-chooser/method=us",
         " fb=false<wait>",
         " keyboard-configuration/layout=USA<wait>",
         " keyboard-configuration/variant=USA<wait>",
         " locale=en_US<wait>",
         " hostname={{ .Name }}",
         " auto=true<wait>",
         " console-setup/ask_detect=false",
         " auto-install/enable=true ",
         " debconf/priority=critical ",
         " -- <wait>",
         "<enter><wait>"
  ],
  "shutdown_command": "shutdown -P now"
}
  ],
  "provisioners": [
    {
    "type": "shell",
    "inline": [ "echo 'ansible' | sudo -S bash -c 'mkdir /root/.ssh'"]
   },
   {
     "type": "file",
     "source": "./http/id_rsa_ansible.pub",
     "destination": "/root/.ssh/authorized_keys"
   },
   {
     "type": "ansible",
     "playbook_file": "./ansible/kickstart.yml",
     "user": "root",
     "extra_arguments": ["--diff"]
    },
    {
     "type": "shell",
     "scripts": [
         "scripts/setup.sh",
         "scripts/cleanup.sh"
    ]
    }
 ]
}
